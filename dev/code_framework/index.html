<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Full Setup and Solution Overview · DuctTAPE.jl</title><script data-outdated-warner src="../assets/warner.js"></script><link rel="canonical" href="https://flow.byu.edu/DuctTAPE.jl/code_framework/"/><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.045/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.13.24/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL=".."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../assets/documenter.js"></script><script src="../siteinfo.js"></script><script src="../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><div class="docs-package-name"><span class="docs-autofit"><a href="../">DuctTAPE.jl</a></span></div><form class="docs-search" action="../search/"><input class="docs-search-query" id="documenter-search-query" name="q" type="text" placeholder="Search docs"/></form><ul class="docs-menu"><li><a class="tocitem" href="../">Intro</a></li><li><a class="tocitem" href="../tutorial/">Quick Start</a></li><li><a class="tocitem" href="../examples/">Guided Examples</a></li><li><a class="tocitem" href="../reference/">API Reference</a></li><li><a class="tocitem" href="../theory/">Theory</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><nav class="breadcrumb"><ul class="is-hidden-mobile"><li class="is-active"><a href>Full Setup and Solution Overview</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Full Setup and Solution Overview</a></li></ul></nav><div class="docs-right"><a class="docs-edit-link" href="https://github.com/byuflowlab/DuctTAPE.jl/blob/main/docs/src/code_framework.md#" title="Edit on GitHub"><span class="docs-icon fab"></span><span class="docs-label is-hidden-touch">Edit on GitHub</span></a><a class="docs-settings-button fas fa-cog" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-sidebar-button fa fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a></div></header><article class="content" id="documenter-page"><h1 id="Full-Setup-and-Solution-Overview"><a class="docs-heading-anchor" href="#Full-Setup-and-Solution-Overview">Full Setup and Solution Overview</a><a id="Full-Setup-and-Solution-Overview-1"></a><a class="docs-heading-anchor-permalink" href="#Full-Setup-and-Solution-Overview" title="Permalink"></a></h1><h2 id="Setup"><a class="docs-heading-anchor" href="#Setup">Setup</a><a id="Setup-1"></a><a class="docs-heading-anchor-permalink" href="#Setup" title="Permalink"></a></h2><ol><li><a href="#1-define-ducthub-geometry">Define Duct/Hub Geometry</a></li><li><a href="#2-define-rotor-non-dimensional-geometry">Define Rotor non-dimensional Geometry</a></li><li><a href="#3-define-wake-grid-geometry">Define Wake Grid Geometry</a></li><li><a href="#4-define-paneling">Define Paneling</a></li><li><a href="#5-set-first-guess-for-rotor-flow-conditions">Set first guess for rotor flow conditions</a></li><li><a href="#6-get-first-guess-rotor-circulations">Get first guess rotor circulations</a></li><li><a href="#7-get-first-guess-grid-flow-data">Get first guess grid flow data</a></li><li><a href="#8-get-first-guess-wake-vortex-sheet-strengths">Get first guess wake vortex sheet strengths</a></li><li><a href="#9-calculate-velocities-and-coefficients">Calculate velocities and coefficients</a></li><li><a href="#10-calculate-blade-section-source-strengths">Calculate blade section source strengths</a></li><li>[Get initial solution for <span>$\overline{\gamma}$</span>]</li><li>[Update control point velocities]</li><li>[Update grid flow data]</li></ol><p>Once we have an initial solution set, we&#39;re ready to start the interative solution process.</p><h2 id="Solution"><a class="docs-heading-anchor" href="#Solution">Solution</a><a id="Solution-1"></a><a class="docs-heading-anchor-permalink" href="#Solution" title="Permalink"></a></h2><ul><li>In loop, until converged or hit iteration limit:<ol><li>Solve for <span>$\overline{\gamma}$</span></li><li>update control point velocities</li><li>update wake grid flow data (all the tilde things in dfdc theory (H, S, <span>$\Gamma$</span>)</li><li>Update rotor velocities</li><li>find new airfoil data based on updated velocities</li><li>find changes in blade circulation</li><li>get relaxation factors based on changes in blade circulation</li><li>update blade circulation with relaxed values</li><li>update <span>$V_m$</span> values on wakes</li><li>update <span>$\gamma_\theta$</span> values with relaxed values</li></ol></li></ul><h2 id="Post-Process"><a class="docs-heading-anchor" href="#Post-Process">Post Process</a><a id="Post-Process-1"></a><a class="docs-heading-anchor-permalink" href="#Post-Process" title="Permalink"></a></h2><ol><li>calculate surface pressure and forces (qcpfor in vels.f line 32)<ul><li>Note that this is actually done in every iteration in dfdc, but it doesn&#39;t look like it needs to be called every time, since it doesn&#39;t update anything, just post processes.</li></ul></li></ol><hr/><h1 id="Details"><a class="docs-heading-anchor" href="#Details">Details</a><a id="Details-1"></a><a class="docs-heading-anchor-permalink" href="#Details" title="Permalink"></a></h1><h2 id="Setup-2"><a class="docs-heading-anchor" href="#Setup-2">Setup</a><a class="docs-heading-anchor-permalink" href="#Setup-2" title="Permalink"></a></h2><p><em>DFDC: start in GENGEOM, (line 608 in dfdcsubs.f). This function is called right away after heading into the OPER menu. (the geometry is loaded from the case file first though, which is basically just reading in the data.)</em></p><h3 id="**1.-Define-Duct/Hub-Geometry**"><a class="docs-heading-anchor" href="#**1.-Define-Duct/Hub-Geometry**"><strong>1. Define Duct/Hub Geometry</strong></a><a id="**1.-Define-Duct/Hub-Geometry**-1"></a><a class="docs-heading-anchor-permalink" href="#**1.-Define-Duct/Hub-Geometry**" title="Permalink"></a></h3><p>DuctTAPE: Duct wall and hub (walls) are defined using <code>defineDuctGeometry</code> (in walls.jl)</p><h3 id="**2.-Define-Rotor-non-dimensional-Geometry**"><a class="docs-heading-anchor" href="#**2.-Define-Rotor-non-dimensional-Geometry**"><strong>2. Define Rotor non-dimensional Geometry</strong></a><a id="**2.-Define-Rotor-non-dimensional-Geometry**-1"></a><a class="docs-heading-anchor-permalink" href="#**2.-Define-Rotor-non-dimensional-Geometry**" title="Permalink"></a></h3><p>DuctTAPE: Rotors are non-dimensionally defined using <code>initialize_rotor_geometry</code> (in rotors.jl)</p><h3 id="**3.-Define-Wake-Grid-Geometry**"><a class="docs-heading-anchor" href="#**3.-Define-Wake-Grid-Geometry**"><strong>3. Define Wake Grid Geometry</strong></a><a id="**3.-Define-Wake-Grid-Geometry**-1"></a><a class="docs-heading-anchor-permalink" href="#**3.-Define-Wake-Grid-Geometry**" title="Permalink"></a></h3><p><em>DFDC: see INIGRD in inigrd.f (line 32)</em></p><p>DuctTAPE: The rotor wake grid is defined using <code>initialize_wake_grid</code> (in wakegrid.jl) using more or less the same methodology used in DFDC.</p><p>Notes:</p><ul><li>Ideally this step should be done using an inviscid panel solution from the duct/hub geometry, which is what the DFDC theory document indicates, but instead a simple constant freestream and conservation of mass is used in practice.</li><li>If wanting to use an inviscid panel solution for this initialization step, need to figure out how to handle the open hub wall geometry. </li></ul><h3 id="**4.-Define-Paneling**"><a class="docs-heading-anchor" href="#**4.-Define-Paneling**"><strong>4. Define Paneling</strong></a><a id="**4.-Define-Paneling**-1"></a><a class="docs-heading-anchor-permalink" href="#**4.-Define-Paneling**" title="Permalink"></a></h3><p><em>DFDC: The rotor source panel and wake vortex panel portions of this is done in DFDC in SETROTWAK in dfdcsubs.f (line 1509) which calls ADDWAKE (line 1637 in the same file). The wall panel portion of this is started in DFDC in ADJPANL in adjpanl.f (line 32) then finised in CVPGEN in geom.f (line 117)</em></p><p>DuctTAPE: The wall and wake panels are defined in <code>generate_paneling</code> (in panels.jl)</p><h3 id="**5.-Set-first-guess-for-rotor-flow-conditions**"><a class="docs-heading-anchor" href="#**5.-Set-first-guess-for-rotor-flow-conditions**"><strong>5. Set first guess for rotor flow conditions</strong></a><a id="**5.-Set-first-guess-for-rotor-flow-conditions**-1"></a><a class="docs-heading-anchor-permalink" href="#**5.-Set-first-guess-for-rotor-flow-conditions**" title="Permalink"></a></h3><p><em>DFDC: see ROTINITBLD (rotor initialize blade) in rotoper.f (line 174)</em></p><p>DuctTAPE: As in the DFDC code, the function that initializes the rotor flow conditions does a few other things, thus we called our version <code>initialize_system_aerodynamics</code> in system.jl</p><p>Notes:</p><ul><li>Could probably use CCBlade directly for this</li><li>Currently the freestream velocity (constant across the blade) is used to get rotor operating point.<ul><li>Would probably be a more accurate starting point to use an inviscid panel solution to get distributed, rather than average velocities across blade.</li><li>Also wouldn&#39;t be too much extra work, but still have the problem of not knowing how to get an invisid panel solution with the open hub geometry.</li></ul></li></ul><h3 id="**6.-Get-first-guess-rotor-circulations**"><a class="docs-heading-anchor" href="#**6.-Get-first-guess-rotor-circulations**"><strong>6. Get first guess rotor circulations</strong></a><a id="**6.-Get-first-guess-rotor-circulations**-1"></a><a class="docs-heading-anchor-permalink" href="#**6.-Get-first-guess-rotor-circulations**" title="Permalink"></a></h3><p><em>DFDC: see ROTINITBLD as well</em></p><p>DuctTAPE: This is also just part of <code>initialize_system_aerodynamics</code></p><p>Notes:</p><ul><li>It would be easy to get these from CCBlade outputs (W and cl) if using CCBlade for the initialization process.</li></ul><h3 id="**7.-Get-first-guess-grid-flow-data**"><a class="docs-heading-anchor" href="#**7.-Get-first-guess-grid-flow-data**"><strong>7. Get first guess grid flow data</strong></a><a id="**7.-Get-first-guess-grid-flow-data**-1"></a><a class="docs-heading-anchor-permalink" href="#**7.-Get-first-guess-grid-flow-data**" title="Permalink"></a></h3><p>Specifically we want to get the circulations (<span>$\widetilde{\Gamma}$</span>), enthalpies (<span>$\widetilde{H}$</span>), and average <span>$V_m$</span> at each wake grid point.</p><p><em>DFDC: see ROTBG2GRD in inigrd.f (line 434)  (note this is very similar to SETGRDFLW starting in line 357 in the same file.)</em></p><p>DuctTAPE: As just noted above, there are 2 nearly identical DFDC functions that sets the grid values from the rotor blade element values.  We have chosen to combine all these using multiple dispatch under <code>set_grid_aero!</code>, which depending on the number of inputs will select whether or not to update the entropy values (ROTBG2GRD does not, SETGRDFLW does) which requires more information than is available at this point of the initialization, so the entropy information is set up later.  </p><p>Notes:</p><ul><li>The <span>$V_m$</span> calculations are just part of the <code>initialize_system_aerodynamics</code> function.  Only the grid circulation and enthalpy values are defined with <code>set_grid_aero</code>.</li></ul><h3 id="**8.-Get-first-guess-wake-vortex-sheet-strengths**"><a class="docs-heading-anchor" href="#**8.-Get-first-guess-wake-vortex-sheet-strengths**"><strong>8. Get first guess wake vortex sheet strengths</strong></a><a id="**8.-Get-first-guess-wake-vortex-sheet-strengths**-1"></a><a class="docs-heading-anchor-permalink" href="#**8.-Get-first-guess-wake-vortex-sheet-strengths**" title="Permalink"></a></h3><p>Specifically, from grid circulations (<span>$\widetilde{\Gamma}$</span>) and average <span>$V_m$</span>, get first guess wake vortex sheet strengths (<span>$\gamma_\theta$</span>) at each wake panel center.</p><p><em>DFDC: see GTHCALC in rotoper.f (line 1878)</em></p><p>DuctTAPE: <code>calculate_gamma_theta</code></p><p>Notes:</p><ul><li>DFDC does something odd in defining (<span>$\gamma_\theta$</span>) on the walls. It basically does an interpolated taper from the (<span>$\gamma_\theta$</span>) at the trailing edge to zero at the first rotor station. </li></ul><p>I am not sure why it does that at this point, but it&#39;s probably to help some setup later. It could simply be that filler values are required for the calculations, or perhaps it makes things easier since the grid technically lies on the walls since there are wakes eminating from the wall trailing edges.</p><h3 id="**9.-Calculate-velocities-and-coefficients**"><a class="docs-heading-anchor" href="#**9.-Calculate-velocities-and-coefficients**"><strong>9. Calculate velocities and coefficients</strong></a><a id="**9.-Calculate-velocities-and-coefficients**-1"></a><a class="docs-heading-anchor-permalink" href="#**9.-Calculate-velocities-and-coefficients**" title="Permalink"></a></h3><p><em>DFDC: see QAIC in qaic.f starting on line 31</em></p><p>DuctTAPE: TODO</p><p>Notes:</p><ul><li>Second biggest question here. What is being calculated?</li></ul><h3 id="**10.-Calculate-influence-matrix-(LHS-of-system)**"><a class="docs-heading-anchor" href="#**10.-Calculate-influence-matrix-(LHS-of-system)**"><strong>10. Calculate influence matrix (LHS of system)</strong></a><a id="**10.-Calculate-influence-matrix-(LHS-of-system)**-1"></a><a class="docs-heading-anchor-permalink" href="#**10.-Calculate-influence-matrix-(LHS-of-system)**" title="Permalink"></a></h3><p><em>DFDC: see GSYS in system.f (line 328)</em></p><p>DuctTAPE: TODO</p><p>Notes:</p><ul><li>Biggest question also here, what is the system</li></ul><h3 id="**11.-Calculate-blade-section-source-strengths**"><a class="docs-heading-anchor" href="#**11.-Calculate-blade-section-source-strengths**"><strong>11. Calculate blade section source strengths</strong></a><a id="**11.-Calculate-blade-section-source-strengths**-1"></a><a class="docs-heading-anchor-permalink" href="#**11.-Calculate-blade-section-source-strengths**" title="Permalink"></a></h3><p><em>DFDC: see SETROTORSRC in rotoper.f (line 1615)</em></p><p>DuctTAPE: TODO</p><p>Notes:</p><ul><li>Inputs: control point velocities and wake circulations</li><li>probably also propogate source strengths onto wake grid</li></ul><h3 id="**12.-Get-initial-solution-for-\\overline{\\gamma}**"><a class="docs-heading-anchor" href="#**12.-Get-initial-solution-for-\\overline{\\gamma}**"><strong>12. Get initial solution for <span>$\overline{\gamma}$</span></strong></a><a id="**12.-Get-initial-solution-for-\\overline{\\gamma}**-1"></a><a class="docs-heading-anchor-permalink" href="#**12.-Get-initial-solution-for-\\overline{\\gamma}**" title="Permalink"></a></h3><p><em>DFDC: see GSOLVE in system.f (line 1504)</em></p><p>DuctTAPE: TODO</p><p>Notes:</p><ul><li>Biggest question here: what is the system? Are we actually just solving for <span>$\overline{\gamma}$</span></li></ul><h3 id="**13.-Update-control-point-velocities-(sum-influence-of-wall-panels,-wake**-panels,-and-freestream)"><a class="docs-heading-anchor" href="#**13.-Update-control-point-velocities-(sum-influence-of-wall-panels,-wake**-panels,-and-freestream)"><strong>13. Update control point velocities (sum influence of wall panels, wake</strong> panels, and freestream)</a><a id="**13.-Update-control-point-velocities-(sum-influence-of-wall-panels,-wake**-panels,-and-freestream)-1"></a><a class="docs-heading-anchor-permalink" href="#**13.-Update-control-point-velocities-(sum-influence-of-wall-panels,-wake**-panels,-and-freestream)" title="Permalink"></a></h3><p><em>DFDC: see QCSUM in system.f (line 1795)</em></p><p>DuctTAPE: TODO</p><p>Notes:</p><ul><li>Another question: are the control points just on the walls and blades? or are they on the wakes too?</li></ul><h3 id="**14.-Update-grid-flow-data**"><a class="docs-heading-anchor" href="#**14.-Update-grid-flow-data**"><strong>14. Update grid flow data</strong></a><a id="**14.-Update-grid-flow-data**-1"></a><a class="docs-heading-anchor-permalink" href="#**14.-Update-grid-flow-data**" title="Permalink"></a></h3><p>(<span>$\widetilde{H}$</span>, <span>$\widetilde{S}$</span> ,<span>$\widetilde{\Gamma}$</span>)</p><p><em>DFDC: see SETGRDFLW in inigrd.f (line 357)  (see comments above about similarities to <a href="#7-get-first-guess-grid-flow-data">ROTBG2GRD</a>)</em></p><p>DuctTAPE: TODO</p><p>Notes:</p><ul><li>Note that the S values aren&#39;t used until the post processing calculation of forces.</li></ul><hr/><h2 id="Solution-2"><a class="docs-heading-anchor" href="#Solution-2">Solution</a><a class="docs-heading-anchor-permalink" href="#Solution-2" title="Permalink"></a></h2><p>The following steps are all preformed in a loop, until converged or the iteration limit is met:</p><ol><li>Solve for <span>$\overline{\gamma}$</span></li><li>update control point velocities</li><li>update wake grid flow data (all the tilde things in dfdc theory (H, S, <span>$\Gamma$</span>)</li><li>Update rotor velocities</li><li>find new airfoil data based on updated velocities</li><li>find changes in blade circulation</li><li>get relaxation factors based on changes in blade circulation</li><li>update blade circulation with relaxed values</li><li>update <span>$V_m$</span> values on wakes</li><li>update <span>$\gamma_\theta$</span> values with relaxed values</li></ol><hr/><h2 id="Post-Process-2"><a class="docs-heading-anchor" href="#Post-Process-2">Post Process</a><a class="docs-heading-anchor-permalink" href="#Post-Process-2" title="Permalink"></a></h2><ol><li>Calculate surface pressure and forces</li></ol><p>DFDC: see QCPFOR in vels.f (line 32)</p><p>Notes:</p><ul><li>this is actually done in every iteration in dfdc, but it doesn&#39;t look like it needs to be called every time, since it doesn&#39;t update anything, just post processes.</li></ul></article><nav class="docs-footer"><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 0.27.23 on <span class="colophon-date" title="Thursday 15 September 2022 18:08">Thursday 15 September 2022</span>. Using Julia version 1.8.1.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
