<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Python · DuctAPE.jl</title><meta name="title" content="Python · DuctAPE.jl"/><meta property="og:title" content="Python · DuctAPE.jl"/><meta property="twitter:title" content="Python · DuctAPE.jl"/><meta name="description" content="Documentation for DuctAPE.jl."/><meta property="og:description" content="Documentation for DuctAPE.jl."/><meta property="twitter:description" content="Documentation for DuctAPE.jl."/><script data-outdated-warner src="../../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.050/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.8/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="../.."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../../assets/documenter.js"></script><script src="../../search_index.js"></script><script src="../../siteinfo.js"></script><script src="../../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-mocha.css" data-theme-name="catppuccin-mocha"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-macchiato.css" data-theme-name="catppuccin-macchiato"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-frappe.css" data-theme-name="catppuccin-frappe"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-latte.css" data-theme-name="catppuccin-latte"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><a class="docs-logo" href="../../"><img src="../../assets/logo.png" alt="DuctAPE.jl logo"/></a><div class="docs-package-name"><span class="docs-autofit"><a href="../../">DuctAPE.jl</a></span></div><button class="docs-search-query input is-rounded is-small is-clickable my-2 mx-auto py-1 px-2" id="documenter-search-query">Search docs (Ctrl + /)</button><ul class="docs-menu"><li><a class="tocitem" href="../../">Home</a></li><li><span class="tocitem">DuctAPE</span><ul><li><a class="tocitem" href="../tutorial/">Quick Start</a></li><li><input class="collapse-toggle" id="menuitem-2-2" type="checkbox"/><label class="tocitem" for="menuitem-2-2"><span class="docs-label">API Reference</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../api/analysis/">Analysis</a></li><li><a class="tocitem" href="../api/inputs/">Required Inputs</a></li><li><a class="tocitem" href="../api/options/">Options</a></li><li><a class="tocitem" href="../api/caches/">Precompiled Caches</a></li><li><a class="tocitem" href="../api/outputs/">Outputs</a></li><li><a class="tocitem" href="../api/api_index/">API Index</a></li></ul></li><li><a class="tocitem" href="../visualization/">Visualization</a></li><li><a class="tocitem" href="../theory/">Theory</a></li><li class="is-active"><a class="tocitem" href>Python</a><ul class="internal"><li><a class="tocitem" href="#Setup"><span>Setup</span></a></li><li><a class="tocitem" href="#Example"><span>Example</span></a></li><li><a class="tocitem" href="#Automatic-Derivatives"><span>Automatic Derivatives</span></a></li></ul></li></ul></li><li><span class="tocitem">C<span>$^4$</span>Blade</span><ul><li><a class="tocitem" href="../../C4Blade/intro/">Intro</a></li><li><input class="collapse-toggle" id="menuitem-3-2" type="checkbox"/><label class="tocitem" for="menuitem-3-2"><span class="docs-label">Blade Element Types</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../C4Blade/airfoil_types/DFDC/">DFDC Airfoil Type</a></li><li><a class="tocitem" href="../../C4Blade/airfoil_types/CCBlade/">CCBlade Airfoil Types</a></li><li><a class="tocitem" href="../../C4Blade/airfoil_types/actuator_disk/">Actuator Disk Type</a></li><li><a class="tocitem" href="../../C4Blade/airfoil_types/cascade/">Cascade Types</a></li></ul></li><li><a class="tocitem" href="../../C4Blade/api/">API Index</a></li></ul></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><a class="docs-sidebar-button docs-navbar-link fa-solid fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a><nav class="breadcrumb"><ul class="is-hidden-mobile"><li><a class="is-disabled">DuctAPE</a></li><li class="is-active"><a href>Python</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Python</a></li></ul></nav><div class="docs-right"><a class="docs-navbar-link" href="https://github.com/byuflowlab/DuctAPE.jl/blob/{commit}{path}#L{line}" title="View the repository on GitHub"><span class="docs-icon fa-brands"></span><span class="docs-label is-hidden-touch">GitHub</span></a><a class="docs-navbar-link" href="https://github.com/byuflowlab/DuctAPE.jl/blob/main/docs/src/DuctAPE/python_tutorial.md" title="Edit source on GitHub"><span class="docs-icon fa-solid"></span></a><a class="docs-settings-button docs-navbar-link fa-solid fa-gear" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-article-toggle-button fa-solid fa-chevron-up" id="documenter-article-toggle-button" href="javascript:;" title="Collapse all docstrings"></a></div></header><article class="content" id="documenter-page"><h1 id="Calling-DuctAPE-from-Python"><a class="docs-heading-anchor" href="#Calling-DuctAPE-from-Python">Calling DuctAPE from Python</a><a id="Calling-DuctAPE-from-Python-1"></a><a class="docs-heading-anchor-permalink" href="#Calling-DuctAPE-from-Python" title="Permalink"></a></h1><p>In this example we repeat the <a href="../tutorial/">quick start</a>, but with Python.  We won&#39;t repeat all the usage details described in the quick start.  We are using the <a href="https://juliapy.github.io/PythonCall.jl/stable/">JuliaCall</a> packages to enable this.</p><h2 id="Setup"><a class="docs-heading-anchor" href="#Setup">Setup</a><a id="Setup-1"></a><a class="docs-heading-anchor-permalink" href="#Setup" title="Permalink"></a></h2><pre><code class="language-python hljs"># optional: point python to a specific julia installation
# import os
# os.environ[&quot;JULIA_BINDIR&quot;] = path_to_julia

from juliacall import Main as jl

# If needed, install DuctAPE into the python julia environment
jl.seval(&quot;using Pkg&quot;)
jl.Pkg.add(&quot;DuctAPE&quot;)

# Load DuctAPE
jl.seval(&quot;using DuctAPE&quot;)

import numpy as np</code></pre><h2 id="Example"><a class="docs-heading-anchor" href="#Example">Example</a><a id="Example-1"></a><a class="docs-heading-anchor-permalink" href="#Example" title="Permalink"></a></h2><pre><code class="language-python hljs"># - Same Quick Start as Before, but with some minor changes for Python syntax - #
duct_coordinates = np.array(
    [
        [0.304466, 0.158439],
        [0.294972, 0.158441],
        [0.28113, 0.158423],
        [0.266505, 0.158365],
        [0.251898, 0.158254],
        [0.237332, 0.158088],
        [0.222751, 0.157864],
        [0.208123, 0.157586],
        [0.193399, 0.157258],
        [0.178507, 0.156897],
        [0.16349, 0.156523],
        [0.148679, 0.156177],
        [0.134222, 0.155902],
        [0.12, 0.155721],
        [0.106044, 0.155585],
        [0.092531, 0.155498],
        [0.079836, 0.155546],
        [0.067995, 0.155792],
        [0.057025, 0.156294],
        [0.046983, 0.157103],
        [0.037937, 0.158256],
        [0.029956, 0.159771],
        [0.02311, 0.161648],
        [0.017419, 0.163862],
        [0.012842, 0.166404],
        [0.009324, 0.169289],
        [0.006854, 0.172546],
        [0.005484, 0.176154],
        [0.005242, 0.180005],
        [0.006112, 0.184067],
        [0.00809, 0.188086],
        [0.011135, 0.192004],
        [0.015227, 0.19579],
        [0.020339, 0.199393],
        [0.026403, 0.202735],
        [0.033312, 0.205736],
        [0.040949, 0.208332],
        [0.049193, 0.210487],
        [0.057935, 0.212174],
        [0.067113, 0.21339],
        [0.076647, 0.214136],
        [0.086499, 0.214421],
        [0.09661, 0.214255],
        [0.10695, 0.213649],
        [0.117508, 0.212618],
        [0.12838, 0.211153],
        [0.139859, 0.209267],
        [0.151644, 0.207051],
        [0.163586, 0.204547],
        [0.175647, 0.201771],
        [0.187807, 0.198746],
        [0.20002, 0.19549],
        [0.212269, 0.192017],
        [0.224549, 0.188335],
        [0.236794, 0.18447],
        [0.249026, 0.180416],
        [0.261206, 0.176188],
        [0.273301, 0.171796],
        [0.28524, 0.16727],
        [0.29644, 0.162842],
        [0.304542, 0.159526],
    ]
)

center_body_coordinates = np.array(
    [
        [0.0, 0.0],
        [0.000586, 0.005293],
        [0.002179, 0.010047],
        [0.004736, 0.014551],
        [0.008231, 0.018825],
        [0.012632, 0.022848],
        [0.01788, 0.026585],
        [0.023901, 0.030001],
        [0.030604, 0.033068],
        [0.0379, 0.035771],
        [0.045705, 0.038107],
        [0.053933, 0.040075],
        [0.06254, 0.04169],
        [0.071451, 0.042966],
        [0.08063, 0.043916],
        [0.090039, 0.044561],
        [0.09968, 0.044922],
        [0.109361, 0.044999],
        [0.12, 0.044952],
        [0.135773, 0.04495],
        [0.151899, 0.04493],
        [0.16806, 0.044913],
        [0.184232, 0.044898],
        [0.200407, 0.044882],
        [0.21658, 0.044866],
        [0.232723, 0.044847],
        [0.248578, 0.044839],
        [0.262095, 0.044564],
        [0.274184, 0.043576],
        [0.285768, 0.041795],
        [0.296701, 0.039168],
        [0.306379, 0.035928],
    ]
)

# number of rotors
B = 5

# rotor axial location
rotor_axial_position = 0.12

# rotor tip radius
Rtip = 0.15572081487373543

# rotor hub radius
Rhub = 0.04495252299071941

# non-dimensional blade element radial stations
r = (
    np.array(
        [
            0.050491,
            0.061567,
            0.072644,
            0.083721,
            0.094798,
            0.10587,
            0.11695,
            0.12803,
            0.13911,
            0.15018,
        ]
    )
    / Rtip
)

# dimensional chord lengths
chords = np.array(
    [
        0.089142,
        0.079785,
        0.0713,
        0.063979,
        0.057777,
        0.052541,
        0.048103,
        0.044316,
        0.041061,
        0.038243,
    ]
)

# twist angles (from plane of rotation) in radians
twists = (
    np.array(
        [
            69.012,
            59.142,
            51.825,
            46.272,
            41.952,
            38.509,
            35.699,
            33.354,
            31.349,
            29.596,
        ]
    )
    * np.pi
    / 180.0
)

# DFDC-type airfoil object
afparams = jl.DuctAPE.c4b.DFDCairfoil(
    alpha0=0.0,
    clmax=1.5,
    clmin=-1.0,
    dclda=6.28,
    dclda_stall=0.5,
    dcl_stall=0.2,
    cdmin=0.012,
    clcdmin=0.1,
    dcddcl2=0.005,
    cmcon=0.0,
    Re_ref=2e5,
    Re_exp=0.35,
    mcrit=0.7,
)

# all airfoils are the same
# NOTE: airfoils are inputs as a vector of vectors rather than a matrix
airfoils = [[afparams] * len(r)]

# Assemble Rotor object
rotor = jl.DuctAPE.Rotor(
    B,
    rotor_axial_position,
    r,
    Rhub,
    Rtip,
    chords,
    twists,
    [0.0],  # tip gap vector
    airfoils,  # vector-of-vectors of DFDCairfoil objects
    [0.0],  # is_stator flag vector
)

# number of panels for the duct inlet
num_duct_inlet_panels = 30

# number of panels for the center body inlet
num_center_body_inlet_panels = 30

# number of panels:
#  - rotor → duct TE
#  - duct TE → center-body TE
#  - center-body TE → end of wake
num_panels = [30, 1, 30]

# duct TE ahead of center-body TE
dte_minus_cbte = -1.0

# number of wake sheets (one more than blade elements)
num_wake_sheets = 11

# non-dimensional wake length aft of rear-most TE
wake_length = 0.8

# assemble paneling constants
paneling_constants = jl.DuctAPE.PanelingConstants(
    num_duct_inlet_panels,
    num_center_body_inlet_panels,
    num_panels,
    dte_minus_cbte,
    num_wake_sheets,
    wake_length,
)

# assemble ducted rotor object
ducted_rotor = jl.DuctAPE.DuctedRotor(
    duct_coordinates,
    center_body_coordinates,
    rotor,
    paneling_constants,
)

# Freestream
Vinf = 30.0
rhoinf = 1.226
asound = 340.0
muinf = 1.78e-5

# Rotation rate
RPM = 8000.0
Omega = RPM * np.pi / 30.0  # rad/s

# assemble operating point
operating_point = jl.DuctAPE.OperatingPoint(
    Vinf,
    Omega,
    rhoinf,
    muinf,
    asound,
)

# reference velocity (close to average axial velocity at rotor)
Vref = 50.0

# reference radius (usually rotor tip radius)
Rref = Rtip

# assemble reference parameters
reference_parameters = jl.DuctAPE.ReferenceParameters(
    [Vref],
    [Rref],
)

# set options
options = jl.DuctAPE.set_options()

# Run DuctAPE
outs, success_flag = jl.DuctAPE.analyze(
    ducted_rotor,
    operating_point,
    reference_parameters,
    options,
)

# Print some outputs.
print(&quot;CT: &quot;, outs.totals.CT)
print(&quot;CQ: &quot;, outs.totals.CQ)</code></pre><h2 id="Automatic-Derivatives"><a class="docs-heading-anchor" href="#Automatic-Derivatives">Automatic Derivatives</a><a id="Automatic-Derivatives-1"></a><a class="docs-heading-anchor-permalink" href="#Automatic-Derivatives" title="Permalink"></a></h2><p>We now continue the example demonstrating how to get derivatives for use in Python (but where the derivative computation occurs in Julia via algorithmic differentiation).  For this functionality we need to load the <a href="https://juliapy.github.io/PythonCall.jl/stable/">PythonCall</a> package (which enables us to call back into Python from Julia), and we need the <a href="https://github.com/byuflowlab/ImplicitAD.jl">ImplicitAD</a> packages which provides a convenience function for the derivative computation.  Alternatively, for more advanced users you can just use the Julia differentiation packages directly (ForwardDiff, ReverseDiff, etc.).  Note that for Julia AD to work, all the function calls will need to be Julia function calls.  Even though all the setup is happening here in Python, we are only setting up inputs.  All functions are calls to Julia (jl.somefunction())</p><p>The below example demonstrates a forward mode Jacobian and a forward mode Jacobian-vector product.  Other options (reverse Jacobian, reverse vector-Jacobian product) are discussed in <a href="https://github.com/byuflowlab/ImplicitAD.jl">ImplicitAD</a> docs.</p><pre><code class="language-python hljs"># load PythonCall BEFORE ImplicitAD
jl.seval(&quot;using PythonCall&quot;)

# Install ImplicitAD as needed
jl.seval(&quot;using Pkg&quot;)
jl.Pkg.add(&quot;ImplicitAD&quot;)

# Load ImplicitAD.derivativesetup
jl.seval(&quot;using ImplicitAD: derivativesetup&quot;)

nc = len(chords)

# ImplicitAD expects a funciton we want to differentiate in the form f = func(x, p)
# where f is output vector, x is input vector, and p are parameters we do not differentiate w.r.t.
def dtwrap(x, p):
    chords = x[:nc]
    twists = x[nc:]

    # Assemble Rotor object
    rotor = jl.DuctAPE.Rotor(
        B,
        rotor_axial_position,
        r,
        Rhub,
        Rtip,
        chords,
        twists,
        [0.0],  # tip gap vector
        airfoils,  # vector-of-vectors of DFDCairfoil objects
        [0.0],  # is_stator flag vector
    )

    # assemble ducted rotor object
    ducted_rotor = jl.DuctAPE.DuctedRotor(
        duct_coordinates,
        center_body_coordinates,
        rotor,
        paneling_constants,
    )

    # Run DuctAPE
    outs, success_flag = jl.DuctAPE.analyze(
        ducted_rotor,
        operating_point,
        reference_parameters,
        options,
    )

    return [outs.totals.CT, outs.totals.CQ]


x = np.concatenate([chords, twists])
p = ()
jacobian = jl.derivativesetup(
    dtwrap, x, p, &quot;fjacobian&quot;
)  # a forward-mode Jacobian is one option

# preallocate Jacobian then evaluate
J = np.zeros((2, len(x)))
jacobian(J, x)
print(J)
# can now change x, and evaluate jacobian(J, x) repeatedly at other points


# demonstrate a Jacobian-vector product
jvp = jl.derivativesetup(dtwrap, x, p, &quot;jvp&quot;)
xdot = np.ones(len(x))
fdot = np.zeros(2)
jvp(fdot, x, xdot)
print(fdot)
# can continue to call jvp for different x, xdot pairs</code></pre></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../theory/">« Theory</a><a class="docs-footer-nextpage" href="../../C4Blade/intro/">Intro »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="auto">Automatic (OS)</option><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option><option value="catppuccin-latte">catppuccin-latte</option><option value="catppuccin-frappe">catppuccin-frappe</option><option value="catppuccin-macchiato">catppuccin-macchiato</option><option value="catppuccin-mocha">catppuccin-mocha</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 1.16.1 on <span class="colophon-date" title="Tuesday 25 November 2025 19:16">Tuesday 25 November 2025</span>. Using Julia version 1.10.10.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
